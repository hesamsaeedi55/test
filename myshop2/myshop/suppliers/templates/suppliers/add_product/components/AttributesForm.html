{% load static %}
{% load i18n %}

<!-- Attributes Form Component -->
<div class="form-section">
    <h2 class="section-title">ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</h2>
    <div class="section-content">
        <!-- Variant Attributes Notice -->
        <div id="variantAttributesNotice" style="display: none; margin-bottom: 1rem; padding: 1rem; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px;">
            <h4 style="color: #856404; margin: 0 0 0.5rem 0;">âš ï¸ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…ØªØºÛŒØ±</h4>
            <p style="color: #856404; margin: 0; font-size: 0.9rem;">
                Ø¨Ø±Ø®ÛŒ Ø§Ø² ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ÙˆØ§Ø¹ Ù…Ø­ØµÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯ Ùˆ Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.
                Ø§ÛŒÙ† ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± Ø¨Ø®Ø´ "Ø§Ù†ÙˆØ§Ø¹ Ù…Ø­ØµÙˆÙ„" Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ… Ù‡Ø³ØªÙ†Ø¯.
            </p>
            <div id="hiddenVariantAttributesList" style="margin-top: 0.5rem; font-size: 0.8rem; color: #6c757d;">
                <!-- Hidden variant attributes will be listed here -->
            </div>
        </div>
        
        <!-- Display form-level errors -->
        {% if form.non_field_errors %}
            <div class="alert alert-danger" style="margin-bottom: 1rem; padding: 1rem; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px;">
                <h4 style="color: #721c24; margin: 0 0 0.5rem 0;">âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ</h4>
                {% for error in form.non_field_errors %}
                    <p style="color: #721c24; margin: 0; font-size: 0.9rem;">{{ error }}</p>
                {% endfor %}
            </div>
        {% endif %}
        
        <!-- Container for attributes populated by JavaScript (single source of truth) -->
        <div id="attributes-container" class="attributes-container"></div>
        
        <!-- Hidden container for JavaScript-created fields (will be populated but not used for form submission) -->
        <div id="js-attributes-container" style="display: none;"></div>
        
        <script>
        // Hide variant attribute fields on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ” Hiding variant attribute fields...');
            
            // Get variant attributes from the preserved data
            const preservedVariantAttributes = {{ preserved_variant_attributes|default:"[]"|safe }};
            console.log('ğŸ” Preserved variant attributes:', preservedVariantAttributes);
            
            // Hide fields for variant attributes
            preservedVariantAttributes.forEach(function(attrKey) {
                const fieldElement = document.querySelector(`[data-attribute-key="${attrKey}"]`);
                if (fieldElement) {
                    console.log(`ğŸ” Hiding variant attribute field: ${attrKey}`);
                    fieldElement.style.display = 'none';
                } else {
                    console.log(`ğŸ” Variant attribute field not found: ${attrKey}`);
                }
            });
            
            // Also check if has_variants is enabled and hide common variant attributes
            const hasVariantsCheckbox = document.getElementById('has_variants');
            if (hasVariantsCheckbox && hasVariantsCheckbox.checked) {
                console.log('ğŸ” Has variants is enabled, checking for common variant attributes...');
                
                // Common variant attribute keys
                const commonVariantKeys = ['brand', 'Ø¬Ù†Ø³ÛŒØª', 'Ø³Ø±ÛŒ', 'Ù†ÙˆØ¹ Ø­Ø±Ú©Øª', 'color', 'size', 'Ø±Ù†Ú¯', 'Ø³Ø§ÛŒØ²'];
                
                commonVariantKeys.forEach(function(attrKey) {
                    const fieldElement = document.querySelector(`[data-attribute-key="${attrKey}"]`);
                    if (fieldElement) {
                        console.log(`ğŸ” Hiding common variant attribute field: ${attrKey}`);
                        fieldElement.style.display = 'none';
                    }
                });
            }
        });
        </script>
    </div>
</div>
